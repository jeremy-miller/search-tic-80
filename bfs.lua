-- title:  Breadth-First Search
-- author: Jeremy Miller
-- desc:   Breadth-first search visualized
-- script: lua

-- sprites
FLOOR=0
WALL=1
START=2
VISITED=3
QUEUED=4
GOAL=5
PATH=6

-- buttons
A=4

MAP_WIDTH=30
MAP_HEIGHT=17

function init()
	queue={}
	visited={}
	start={
		x=1,
		y=1,
		visited=false,
		parent=nil,
	}
	table.insert(queue,start)
	goal={
		x=28,
		y=15,
	}
	current=nil
	done=false
end

function input()
	if btnp(A) then
		-- restart
		resetMap()
		init()
	end
end

-- Clear map of any existing sprites
function resetMap()
	for y=1,MAP_HEIGHT-2 do
		for x=1,MAP_WIDTH-2 do
			mset(x,y,FLOOR)
		end
	end
end

function update()
	if not done then
		if #queue>0 then
			current=pop()
			if current.x==goal.x and
						current.y==goal.y then
				-- found goal
				done=true
			else
				-- no goal yet, keep looking
				addAdjacentCells(current)
			end
		else
			-- no more edges, didn't find goal
		end
	end
end

-- Remove first cell from queue and
-- return it
function pop()
	local cell=queue[1]
	table.remove(queue,1)
	cell.visited=true
	table.insert(visited,cell)
	return cell
end

-- Add adjacent cells of given cell
-- to queue if they aren't already in
-- queue, haven't been visited, and
-- are not walls
function addAdjacentCells(cell)
	local adjacents={
		{x=cell.x,y=cell.y-1},
		{x=cell.x,y=cell.y+1},
		{x=cell.x-1,y=cell.y},
		{x=cell.x+1,y=cell.y},
	}
	for _,c in ipairs(adjacents) do
		if not contains(queue,c.x,c.y) and
					not contains(visited,c.x,c.y) and
					mget(c.x,c.y)~=WALL then
			local adjacentCell={
				x=c.x,
				y=c.y,
				visited=false,
				parent=cell,
			}
			table.insert(queue,adjacentCell)
		end
	end
end

-- Check if a cell with given X/Y is
-- in given table "t"
function contains(t,x,y)
	for _,item in ipairs(t) do
		if item.x==x and item.y==y then
			return true
		end
	end
	return false
end

function draw()
	drawMap()
	drawVisited()
	drawQueue()
	drawPath()
	drawStartEnd()
end

function drawMap()
	map(0,0,30,17)
end

function drawVisited()
	for _,cell in ipairs(visited) do
		mset(cell.x,cell.y,VISITED)
	end
end

function drawQueue()
	for _,cell in ipairs(queue) do
		mset(cell.x,cell.y,QUEUED)
	end
end

function drawPath()
	if done then
		drawPathCell(current)
	end
end

function drawPathCell(cell)
	mset(cell.x,cell.y,PATH)
	if cell.parent then
		drawPathCell(cell.parent)
	end
end

function drawStartEnd()
	mset(start.x,start.y,START)
	mset(goal.x,goal.y,GOAL)
end

init()

function TIC()
	cls()
	input()
	update()
	draw()
end

-- <TILES>
-- 001:eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
-- 002:2222222222222222222222222222222222222222222222222222222222222222
-- 003:9999999999999999999999999999999999999999999999999999999999999999
-- 004:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 005:6666666666666666666666666666666666666666666666666666666666666666
-- 006:3333333333333333333333333333333333333333333333333333333333333333
-- </TILES>

-- <MAP>
-- 000:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:100000000000000000000000000000100000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:100000100000001010101000100000100010000000000000000000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:100000100000000000001000100000000010001010101010101010100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:100000101010101010101000100000000010001000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:100000000000000010000000100000000010001010101010101000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:100000000000000010000000100000100000000010000010000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:100000000000000010000000100000100000000010000010000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:100000000000000010000000100000101010101010000010000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:100010101010101010001010100000100000001000000010001010100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:100010000000000010000000100000100000001000000010001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:100010000000100010000000000000100000000000000000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:100010101010100010101010101010101010001000000000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:100000000000000010000000100000000000001010101010101000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:100000101010101010001000000000001010101000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:100000000000000000001000000000000000001000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

